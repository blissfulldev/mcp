services:
  aws-diagram:
    build:
      context: ./src/aws-diagram-mcp-server
      dockerfile: Dockerfile
    container_name: aws-diagram
    ports:
      - "8001:8001"
    networks:
      - mcp_net
    environment:
      - DIAGRAMS_CONTAINER_DIRECTORY=/app/generated-diagrams
    volumes:
      - ${DIAGRAMS_HOST_DIRECTORY:-./workspace/generated-diagrams}:${DIAGRAMS_CONTAINER_DIRECTORY}
  
  core-mcp:
    build:
      context: ./src/core-mcp-server
      dockerfile: Dockerfile
    container_name: core-mcp
    ports:
      - "8000:8000"
    networks:
      - mcp_net
    environment:
      aws-foundation: "true"
      dev-tools: "true"
      ci-cd-devops: "true"
      container-orchestration: "true"
      serverless-architecture: "true"
      solutions-architect: "true"
      security-identity: "true"

  terraform-mcp:
    build:
      context: ./src/terraform-mcp-server
      dockerfile: Dockerfile
    container_name: terraform-mcp
    ports:
      - "8002:8002"
    networks:
      - mcp_net
    environment:
      - TERRAFORM_CONTAINER_DIRECTORY=/app/terraform-projects
    volumes:
      - ${TERRAFORM_HOST_DIRECTORY:-./workspace/terraform-projects}:${TERRAFORM_CONTAINER_DIRECTORY}

networks:
  mcp_net:
    external: true
    name: mcp_net
    driver: bridge
